-- Freeze All Players Script (One File)

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Tạo RemoteEvent nếu chưa có
local event = ReplicatedStorage:FindFirstChild("FreezeEvent")
if not event then
	event = Instance.new("RemoteEvent")
	event.Name = "FreezeEvent"
	event.Parent = ReplicatedStorage
end

-- Server xử lý (chỉ chạy 1 lần)
if not getgenv().FreezeServerLoaded then
	getgenv().FreezeServerLoaded = true

	event.OnServerEvent:Connect(function(player)
		getgenv().frozen = not getgenv().frozen

		for _, plr in pairs(Players:GetPlayers()) do
			if plr.Character and plr.Character:FindFirstChild("Humanoid") then
				if getgenv().frozen then
					plr.Character.Humanoid.WalkSpeed = 0
					plr.Character.Humanoid.JumpPower = 0
				else
					plr.Character.Humanoid.WalkSpeed = 16
					plr.Character.Humanoid.JumpPower = 50
				end
			end
		end

		-- Thông báo trạng thái về client để đổi text nút
		for _, plr in pairs(Players:GetPlayers()) do
			event:FireClient(plr, getgenv().frozen)
		end
	end)
end

-- Tạo GUI cho người chơi
local player = Players.LocalPlayer
local gui = Instance.new("ScreenGui")
gui.Name = "FreezeGui"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 180, 0, 50)
button.Position = UDim2.new(0.5, -90, 0.9, -25)
button.Text = "Đóng băng tất cả"
button.BackgroundColor3 = Color3.fromRGB(50, 50, 200)
button.TextColor3 = Color3.fromRGB(255, 255, 255)
button.Font = Enum.Font.SourceSansBold
button.TextSize = 20
button.Parent = gui

-- Bấm gửi tín hiệu
button.MouseButton1Click:Connect(function()
	event:FireServer()
end)

-- Nhận trạng thái từ server để đổi text nút
event.OnClientEvent:Connect(function(frozen)
	if frozen then
		button.Text = "Bỏ đóng băng"
		button.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
	else
		button.Text = "Đóng băng tất cả"
		button.BackgroundColor3 = Color3.fromRGB(50, 50, 200)
	end
end)
